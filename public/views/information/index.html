<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Triplete | Informacion</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="../../css/informacion.css">
    <style>

    </style>
    <script>
    window.addEventListener("DOMContentLoaded",()=>{
        console.log("bagre");
        if (!localStorage.getItem("session")){
          location.href = '..'
        }
      }
    ) 
    </script>
</head>

<body>
  <nav-bar inref="../login" upref="../register" pref="../profile" href="../" bref="../bet" iref="../information"></nav-bar>
  <div class="container bg-dark mt-5" style="border-radius: 10px">
    <nav class="mt-2">
      <div class="nav nav-tabs mt-2" id="nav-tab" role="tablist">
        <a class="nav-item nav-link active mt-2" id="nav-team-tab" data-toggle="tab" href="#nav-team" role="tab" aria-controls="nav-team" aria-selected="true" style="color:white">Equipos</a>
        <a class="nav-item nav-link mt-2" id="nav-matches-tab" data-toggle="tab" href="#nav-matches" role="tab" aria-controls="nav-matches" aria-selected="false" style="color:white">Partidos</a>
        <a class="nav-item nav-link mt-2" id="nav-tourney-tab" data-toggle="tab" href="#nav-tourney" role="tab" aria-controls="nav-tourney" aria-selected="false" style="color:white">Torneos</a>
      </div>
    </nav>

    <div class="tab-content" id="nav-tabContent">
      <div class="tab-pane fade show active" id="nav-team" role="tabpanel" aria-labelledby="nav-team-tab">
        
        <div class="row mb-2" id="searchRow">
            <div class="input-group col-sm-8 mt-2">
              <input type="text success" id="searchTeam" class="form-control" placeholder="Nombre de equipo" aria-label="Nombre de Equipo" aria-describedby="button-addon2">
              <div class="input-group-append">
                <button class="btn btn-outline-success btn-add-panel" type="button" id="button-addon2">Search</button>
              </div>
            </div>
        </nav>

        <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="nav-team" role="tabpanel" aria-labelledby="nav-team-tab">

                <div class="row mb-2" id="searchRow">
                    <div class="input-group col-sm-8 mt-2">
                        <input type="text success" id="searchTeam" class="form-control" placeholder="Nombre de equipo" aria-label="Nombre de Equipo" aria-describedby="button-addon2">
                        <div class="input-group-append">
                            <button class="btn btn-outline-success btn-add-panel" type="button" id="button-addon2">Search</button>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <button class="btn btn-outline-danger mt-2" id="clearTeams">Limpiar resultados</button>
                    </div>
                </div>

                <div class="row">
                    <div class="panel-group col" id="accordionTeam"></div>
                </div>
            </div>

            <div class="tab-pane fade" id="nav-matches" role="tabpanel" aria-labelledby="nav-matches-tab">
                <div class="list-group mt-2 pb-2" id="matchesList">
                </div>
            </div>

      <div class="tab-pane fade" id="nav-matches" role="tabpanel" aria-labelledby="nav-matches-tab">
        
        <div class="row mb-2" id="matchSearch">
          <div class="input-group m-3">
            <input type="text" class="form-control" id="searchInput" aria-label="Text input with segmented dropdown button">
            <div class="input-group-append">
              <button type="button" class="btn btn-outline-success" onclick="searchMatches(selectedTournament)">Search</button>
              <button type="button" class="btn btn-outline-success dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="sr-only">Toggle Dropdown</span>
              </button>
            <button class="btn btn-outline-danger rounded mx-2" id="clearMatches">Limpiar resultados</button>
              <div class="dropdown-menu" id="tourneydropDown">
              </div>
            </div>
          </div>
        </div>

        <div class="list-group mt-2 pb-2" id="matchesList"></div>
      </div>

      <div class="tab-pane fade" id="nav-tourney" role="tabpanel" aria-labelledby="nav-tourney-tab">
          <div class="list-group mt-2 pb-2" id="tourneyList"></div>
      </div>
    </div>
  </div>
  </div>
    <script type="text/javascript" src="../../components/navbar.js"></script>
    <script type="text/javascript" src="/popper.js/dist/umd/popper.js"></script>
    <script type="text/javascript" src="/jquery/dist/jquery.js"></script>
    <script type="text/javascript" src="/bootstrap/dist/js/bootstrap.js"></script>
  <script>
      var hash = 1;

      $("#clearMatches").on("click", ()=>{
        removeSearch("#matchesList")
      })

      let addTeam = (obj) =>{
        $("#accordionTeam").append(
          '<div class="panel panel-default mb-1 ml-3 col" style="margin-right: 2%">'+
          '<div class="panel-heading" role="tab" id="heading_'+ ++hash +'">'+
            '<h4 class="panel-title">'+
              '<a role="button" data-toggle="collapse" data-parent="#accordionTeam" href="#collapse_'+ hash +'" aria-expanded="true" aria-controls="collapse_'+hash+'">'+
                  obj.teams_name+
              '</a>'+
            '</h4>'+
          '</div>'+
          '<div id="collapse_'+hash+'" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading_'+hash+'">'+
            '<div class="panel-body">'+
              '<div class="row mb-2">'+
                '<div class="col-sm-8 text-break bg-dark rounded" style="margin-left:10px">'+  
                  "Descripcion: <br/> "+obj.team_description+
                "</div>"+
                '<div class="col-sm-3 bg-dark rounded" style="margin-left: 10px">'+  
                  " Pais: <br/>" +obj.country_name+
                  "<br/>"+
                  "Promedio:</br>"+
                  obj.teams_average+
                "</div>"+
              "</div>"+
            '</div>'+
          '</div>'+
        '</div>'
        )
      }

      let addMatch = (obj) =>{
        let color = '#689f38'
        if(obj.match_played === true){
          color = 'gray'
        }
        $("#matchesList").append(
          `<a href="#" class="list-group-item list-group-item-action text-center" style="background-color: ${color} !important">`+obj.teams.local.name+`(${obj.teams.local.score})`+' vs '+obj.teams.visitante.name+`(${obj.teams.visitante.score})`+
          '</br>Fecha: '+obj.match_date+'</a>'
        )
      }

      let addTourney = (obj) =>{
        $("#tourneyList").append(
          `<a href="../tourney?id=${obj.tournaments_id}" class="list-group-item list-group-item-action text-center">`+ obj.tournaments_name +'</a>'
        )
      }

      let removeSearch = (element) =>{
        $(element).empty()
      }

      let searchTeams = () =>{
        let url = ''
        let search = $("#searchTeam")[0].value;

        if(search.trim() == ''){
          url = "http://localhost:3500/Teams"
        }else{
          url= "http://localhost:3500/Teams/" + search
        }

        fetch(url,{
          method: 'GET',
          headers: {
				    'Content-Type': 'application/json'
          },
          credentials: 'include',
        })
        .then(res => res.json())
        .then(response=>{
          console.log(response)
          if(response.status == 200){
            removeSearch("#accordionTeam")
            response.data.forEach(team => {
              addTeam(team)
            });
          }

        })
        .catch(error=>{
          console.log(error)
        })
      }

      let searchMatches = () =>{
        fetch("http://localhost:3500/Matchs/"+selectedTournament,{
          method: 'GET',
          headers: {
				    'Content-Type': 'application/json'
          },
          credentials: 'include',
        })
        .then(res => res.json())
        .then(res =>{
          if(res.status === 200){
            removeSearch("#matchesList")
            res.data.forEach(match=>{
              addMatch(match);
            })
          }
          console.log(res)
        })
      }

      let selectedTournament = 0;



      let changeSearch = (text,id) =>{
        selectedTournament = id
        document.getElementById('searchInput').value = text
      }

      let annexTourney = (obj) =>{
        $("#tourneydropDown").append(
          `<a class="dropdown-item" onclick="changeSearch('${obj.tournaments_name}',${obj.tournaments_id})">${obj.tournaments_name}</a>`
        )
      }

      $("#clearTeams").on("click", ()=>{
        removeSearch("#accordionTeam")
      })

      fetch('http://localhost:3500/Tournaments',{
        method: 'GET',
        headers: {
				  'Content-Type': 'application/json'
        },
        credentials: 'include',
      })
      .then(res => res.json())
      .then(res =>{
        if(res.status === 200){
          res.data.forEach(tourney => {
            annexTourney(tourney)
            addTourney(tourney)
          });
        }
      })

      $("#button-addon2").on("click", ()=>{
        searchTeams()
      });


    </script> 
</body>

</html>